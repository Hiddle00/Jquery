<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"><script src="jquery-3.7.1.min.js"></script>
    <style>
        #container{
            border : 1px solid black;
            padding : 20px;
            margin-top: 30px;
        }

        .reply{
            border : 1px solid forestgreen;

        }
    </style>
    <title>Document</title>
</head>
<body>
    <h1>댓글</h1>
    <input type="text" id="reply">
    <input type="button" value="작성" id="btn">

    <div class="" id="container">

    </div>
</body>
</html>
<script>
    $("#reply").focus();

    function submit(){
        let reply = $("#reply");
        let value = reply.val();
        if(value.trim() == ""){
            alert("빈문자는 허용하지 않습니다.");
            // >> 만약 value가 ""면 함수 실행 종료
            reply.val("");
            reply.focus();
            return;
        }
        
        let html = "";
        html += "<div class='reply'>";
        html +=     "<div>";
        html +=         value;
        html +=     "</div>";
        html +=     "<input class='modify' type='button' value='수정'>";
        html +=     "<input type='button' value='삭제' onclick='deleteBtn(this)'>";

        //이벤트의 동적부여

        //로딩되는 순간 조건에 맞는 이벤트를 실행하고 이후에 발생한 조건이나 이벤트에 대해서는 관여하지 않음
        //페이지가 로딩될때 조건에 맞는 요소에 대해서 대기하게(이벤트를 기다림) 만들고 이후에 생성된 요소는 코드가 한번 실행되었기 때문에(멀쩡한 코드가 두 번 실행 될 수는 없으므로) 반응 할 수 없음

        html += "</div>";
        //<div class='reply'>안녕하세요</div>
        $("#container").prepend(html);
        //1-2.
        reply.val("");
        reply.focus();
    }
    //이벤트활용
    //댓글 작성
    //1. 작성버튼 클릭시 input text의 입력값을 아래 div에 추가
    //1-1. input text가 공란이면 추가하지 않음
    
    //1-2. 아래 div에 추가한 뒤엔 input text 초기화
    //1-3. 아래 div에 텍스트를 추가할시 마지막 추가 댓글이 맨 위로
    //1-4. input text에서 enter를 누르면 작성한 댓글 추가
    $("#reply").keydown(function(e){
        //키보드 이벤트에서는 눌린 키의 코드를 조회할 수 있다.
        console.log(e);
        //e.key == "Enter"
        //e.wihch == 13
        if(e.key == "Enter"){
            $("#btn").click();
        }
    });

    $("#btn").click(submit).on;

    $(".modify").click(function(){
        alert("수정버튼 클릭");
    })
    //이벤트 동적 바인딩 (위임)
    //미래에 추가될 html요소에도 이벤트를 부여
    $("#container").on("click"      //어떤 이벤트를 부여할지
    , ".modify"                     //감싸고 있는 부모에게 위임했다가 자식이 생기면 자식에게 이벤트 부여
    , function(){ 
        let text = prompt("수정할 댓글 내용을 작성해주세요.");
        //console.log(text);
        //1.수정버튼이 가지고있는 순서(인덱스)
        let index = $(this).parent().index();
        //this = 수정버튼, JS객체
        //$(this)는 jquery객체로 변환
        //$(this).parent() 클릭된 수정버튼의 부모
        //$(this).parent().index() 부모의 순서
        $(".reply > div").eq(index).text(text);
        //$(".reply > div") 클래스가 reply인 요소의 직계자식 div를 찾는다
        //$(".reply > div").eq(index) 순서를 이용해 하나를 찾는다

        //2.버튼이 눌린 수정버튼의 이전요소 div를 찾는다.
        console.log($(this).next().next());
        console.log($(this).prev());
        $(this).prev().text(text);
        //$(this).prev() 클릭된 수정버튼의 이전형제(div)
        //$(this).prev().text(text) div의 텍스트 변경

        $(this).parent().children("div").text(text);
        // == $(this).prev().text(text);
        //next함수는 jquery로 찾은 html요소의 다음(아래)형제 하나를 찾는다.
        //prev()함수는 jquery로 찾은 html요소의 이전(위)형제 하나를 찾는다.
        //parent()함수는 jquery로 찾은 html요소의 부모 하나를 찾는다.
        //children()함수는 jquery로 찾은 html요소의 자식 하나를 찾는다.
    })
    //prepend를 사용하면 코드를 추가하기가 어려워진다
    //댓글삭제 jquery객체의 부모를 찾아서 삭제한다
    function deleteBtn(obj){
        console.log($(obj).parent());
        $(obj).parent().remove();
    }
    
    // let text = prompt("아무값이나 입력해보세요."); //사용자에게 보여주는 값
    //입력한 값을 리턴한다.
    // console.log(text);

</script>